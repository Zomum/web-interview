<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>乙羽的面馆</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="">
    <meta name="referrer" content="no-referrer">
    <link rel="preload" href="/web-interview/assets/css/0.styles.f715369e.css" as="style"><link rel="preload" href="/web-interview/assets/js/app.a79c4355.js" as="script"><link rel="preload" href="/web-interview/assets/js/2.6d940b43.js" as="script"><link rel="preload" href="/web-interview/assets/js/3.f8070b19.js" as="script"><link rel="preload" href="/web-interview/assets/js/35.6d76e154.js" as="script"><link rel="prefetch" href="/web-interview/assets/js/10.f6eb0e9e.js"><link rel="prefetch" href="/web-interview/assets/js/11.d2cdbe11.js"><link rel="prefetch" href="/web-interview/assets/js/12.e2c15ca6.js"><link rel="prefetch" href="/web-interview/assets/js/13.62156d1d.js"><link rel="prefetch" href="/web-interview/assets/js/14.0881b178.js"><link rel="prefetch" href="/web-interview/assets/js/15.ef17828a.js"><link rel="prefetch" href="/web-interview/assets/js/16.1ff8f1c4.js"><link rel="prefetch" href="/web-interview/assets/js/17.f5b159f3.js"><link rel="prefetch" href="/web-interview/assets/js/18.0fbef79d.js"><link rel="prefetch" href="/web-interview/assets/js/19.32254d96.js"><link rel="prefetch" href="/web-interview/assets/js/20.0c92d29f.js"><link rel="prefetch" href="/web-interview/assets/js/21.ee4d64a1.js"><link rel="prefetch" href="/web-interview/assets/js/22.1aa55871.js"><link rel="prefetch" href="/web-interview/assets/js/23.6b771a01.js"><link rel="prefetch" href="/web-interview/assets/js/24.b9e083a0.js"><link rel="prefetch" href="/web-interview/assets/js/25.96ce4959.js"><link rel="prefetch" href="/web-interview/assets/js/26.79b1dfae.js"><link rel="prefetch" href="/web-interview/assets/js/27.02720aa6.js"><link rel="prefetch" href="/web-interview/assets/js/28.a3b9c730.js"><link rel="prefetch" href="/web-interview/assets/js/29.ca613dc0.js"><link rel="prefetch" href="/web-interview/assets/js/30.40fd79cf.js"><link rel="prefetch" href="/web-interview/assets/js/31.d7f711d1.js"><link rel="prefetch" href="/web-interview/assets/js/32.9b5d7767.js"><link rel="prefetch" href="/web-interview/assets/js/33.e8a8bb44.js"><link rel="prefetch" href="/web-interview/assets/js/34.f5acb445.js"><link rel="prefetch" href="/web-interview/assets/js/36.08e9fe43.js"><link rel="prefetch" href="/web-interview/assets/js/37.53c40c29.js"><link rel="prefetch" href="/web-interview/assets/js/38.e5760be3.js"><link rel="prefetch" href="/web-interview/assets/js/39.85d7d625.js"><link rel="prefetch" href="/web-interview/assets/js/4.edf83244.js"><link rel="prefetch" href="/web-interview/assets/js/40.1a0bb226.js"><link rel="prefetch" href="/web-interview/assets/js/41.b9fb1c31.js"><link rel="prefetch" href="/web-interview/assets/js/42.73114142.js"><link rel="prefetch" href="/web-interview/assets/js/5.0c79c06d.js"><link rel="prefetch" href="/web-interview/assets/js/6.3c760815.js"><link rel="prefetch" href="/web-interview/assets/js/7.823691d6.js"><link rel="prefetch" href="/web-interview/assets/js/8.11f9260c.js"><link rel="prefetch" href="/web-interview/assets/js/9.bb6ce6ea.js">
    <link rel="stylesheet" href="/web-interview/assets/css/0.styles.f715369e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/web-interview/" class="home-link router-link-active"><!----> <span class="site-name">乙羽的面馆</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/web-interview/" class="nav-link">
  学习并不是人生的全部。但，既然连人生的一部分 —— 学习也无法征服，还能做什么呢？
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/web-interview/" class="nav-link">
  学习并不是人生的全部。但，既然连人生的一部分 —— 学习也无法征服，还能做什么呢？
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/web-interview/interview-md/CSS.html" class="sidebar-link">CSS</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>H5</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web-interview/interview-md/H5 - HTML.html" class="sidebar-link">HTML</a></li><li><a href="/web-interview/interview-md/H5 - meta.html" class="sidebar-link">meta</a></li><li><a href="/web-interview/interview-md/H5 - svg:canvas:echarts.html" class="sidebar-link">svg:canvas:echarts</a></li><li><a href="/web-interview/interview-md/H5 - video.html" class="sidebar-link">video</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>HTTP</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web-interview/interview-md/HTTP - TCP:IP.html" class="sidebar-link">TCP:IP</a></li><li><a href="/web-interview/interview-md/HTTP - 三次握手四次挥手.html" class="sidebar-link">三次握手四次挥手</a></li><li><a href="/web-interview/interview-md/HTTP - 基础.html" class="sidebar-link">基础</a></li><li><a href="/web-interview/interview-md/HTTP - 安全.html" class="sidebar-link">安全</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web-interview/interview-md/JS - ES6.html" class="sidebar-link">ES6</a></li><li><a href="/web-interview/interview-md/JS - EventLoop.html" class="sidebar-link">EventLoop</a></li><li><a href="/web-interview/interview-md/JS - NJS-JSBridge.html" class="sidebar-link">NJS-JSBridge</a></li><li><a href="/web-interview/interview-md/JS - bind:call:apply.html" class="sidebar-link">bind:call:apply</a></li><li><a href="/web-interview/interview-md/JS - js面试题.html" class="sidebar-link">js面试题</a></li><li><a href="/web-interview/interview-md/JS - new.html" class="sidebar-link">new</a></li><li><a href="/web-interview/interview-md/JS - this.html" class="sidebar-link">this</a></li><li><a href="/web-interview/interview-md/JS - 作用域链.html" class="sidebar-link">作用域链</a></li><li><a href="/web-interview/interview-md/JS - 内存泄露&amp;GC原理.html" class="sidebar-link">内存泄露&amp;GC原理</a></li><li><a href="/web-interview/interview-md/JS - 原型链.html" class="sidebar-link">原型链</a></li><li><a href="/web-interview/interview-md/JS - 异步.html" class="sidebar-link">异步</a></li><li><a href="/web-interview/interview-md/JS - 模块及循环加载.html" class="sidebar-link">模块及循环加载</a></li><li><a href="/web-interview/interview-md/JS - 深拷贝浅拷贝.html" class="sidebar-link">深拷贝浅拷贝</a></li><li><a href="/web-interview/interview-md/JS - 箭头函数.html" class="sidebar-link">箭头函数</a></li><li><a href="/web-interview/interview-md/JS - 继承.html" class="sidebar-link">继承</a></li><li><a href="/web-interview/interview-md/JS - 闭包.html" class="sidebar-link">闭包</a></li><li><a href="/web-interview/interview-md/JS - 防抖节流.html" class="sidebar-link">防抖节流</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web-interview/interview-md/Vue - SSR.html" class="sidebar-link">SSR</a></li><li><a href="/web-interview/interview-md/Vue - 原理.html" class="active sidebar-link">原理</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li><li><a href="/web-interview/interview-md/Webckpack.html" class="sidebar-link">Webckpack</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>浏览器</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web-interview/interview-md/浏览器 - 存储cookie:webStorage:IndexedDB.html" class="sidebar-link">存储cookie:webStorage:IndexedDB</a></li><li><a href="/web-interview/interview-md/浏览器 - 浏览器.html" class="sidebar-link">浏览器</a></li><li><a href="/web-interview/interview-md/浏览器 - 跨域.html" class="sidebar-link">跨域</a></li><li><a href="/web-interview/interview-md/浏览器 - 重绘和回流.html" class="sidebar-link">重绘和回流</a></li></ul></section></li><li><a href="/web-interview/interview-md/笔试篇.html" class="sidebar-link">笔试篇</a></li><li><a href="/web-interview/interview-md/算法篇.html" class="sidebar-link">算法篇</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>【 未完成 】</p> <p><a href="https://juejin.im/post/5ca456bfe51d456d3c45fef4" target="_blank" rel="noopener noreferrer">【Vue原理剖析】Object的变化侦测<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="mvvm-实现思路"><a href="#mvvm-实现思路" class="header-anchor">#</a> MVVM 实现思路</h3> <p>我们都知道，vue是基于MVVM设计模式的渐进式框架。那么在JavaScript中，我们该如何实现一个MVVM框架呢？ 主流的实现MVVM框架的思路有三种：</p> <ul><li>backbone.js</li></ul> <blockquote><p>发布者-订阅者模式，一般通过pub和sub的方式实现数据和视图的绑定。</p></blockquote> <ul><li>Angular.js</li></ul> <blockquote><p>Angular.js是通过脏值监测的方式对比数据是否有变更，来决定是否更新视图。类似于通过定时器轮寻监测数据是否发生了额改变。</p></blockquote> <ul><li>Vue.js</li></ul> <blockquote><p>Vue.js是采用数据劫持结合发布者-订阅者模式的方式。在vue2.6之前，是通过<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty" target="_blank" rel="noopener noreferrer">Object.defineProperty()<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 来劫持各个属性的setter和getter方法，在数据变动时发布消息给订阅者，触发相应的回调。这也是IE8以下的浏览器不支持vue的根本原因。</p></blockquote> <h3 id="vue实现思路"><a href="#vue实现思路" class="header-anchor">#</a> Vue实现思路</h3> <ul><li>实现一个Compile模板解析器，能够对模板中的指令和插值表达式进行解析，并赋予对应的操作</li> <li>实现一个Observer数据监听器，能够对数据对象（data）的所有属性进行监听</li> <li>实现一个Watcher 侦听器。讲Compile的解析结果，与Observer所观察的对象连接起来，建立关系，在Observer观察到数据对象变化时，接收通知，并更新DOM</li> <li>创建一个公共的入口对象（Vue），接收初始化配置，并协调Compile、Observer、Watcher模块，也就是Vue。</li></ul> <p>上述流程如下图所示：</p> <p><img src="img/1C9B8138-117B-461C-81ED-28E462228BB9.png" alt="1C9B8138-117B-461C-81ED-28E462228BB9"></p> <h4 id="vue入口文件"><a href="#vue入口文件" class="header-anchor">#</a> Vue入口文件</h4> <p>把逻辑捋顺清楚后，我们会发现，其实我们要在这个入口文件做的事情很简单：</p> <ul><li>把data和methods挂载到根实例中；</li> <li>用Observer模块监听data所有属性的变化</li> <li>如果存在挂载点，则用Compile模块编译该挂载点下的所有指令和插值表达式</li></ul> <h5 id="compile模块"><a href="#compile模块" class="header-anchor">#</a> Compile模块</h5> <p>compile主要做的事情是解析指令（属性节点）与插值表达式（文本节点），将模板中的变量替换成数据，然后初始化渲染页面视图，并将每个指令对应的节点绑定更新函数，添加监听数据的订阅者，一旦数据有变动，收到通知，更新视图。</p> <h5 id="observer模块"><a href="#observer模块" class="header-anchor">#</a> Observer模块</h5> <p>其实在Observer模块中，我们要做的事情也不多，就是提供一个<code>walk()</code>方法，递归劫持<code>vm.$data</code>中的所有数据，拦截setter和getter。如果数据变更，则发布通知,让所有订阅者更新内容，改变视图。</p> <h5 id="watcher模块"><a href="#watcher模块" class="header-anchor">#</a> Watcher模块</h5> <p>Watcher的作用就是将Compile解析的结果和Observer观察的对象关联起来，建立关系，当Observer观察的数据发生变化是，接收通知（<code>dep.notify</code>）告诉Watcher，Watcher在通过Compile更新DOM。这里面涉及一个发布者-订阅者模式的思想。</p> <h5 id="什么是发布者-订阅者模式？"><a href="#什么是发布者-订阅者模式？" class="header-anchor">#</a> 什么是发布者-订阅者模式？</h5> <blockquote><p>发布者-订阅者模式也叫观察者模式。 他定义了一种一对多的依赖关系，即当一个对象的状态发生改变时，所有依赖于他的对象都会得到通知并自动更新，解决了主体对象与观察者之间功能的耦合。</p></blockquote> <p>譬如我们一个班级都订阅了公众号，那么这个班级的每个人都是订阅者（subscriber），公众号则是发布者（publisher）。如果某一天公众号发现文章内容出错了，需要修改一个错别字（修改vm.$data中的数据），是不是要通知每一个订阅者？总不能学委那里的文章发生了改变，而班长的文章没有发生改变吧。在这个过程中，发布者不用关心谁订阅了它，只需要给所有订阅者推送这条更新的消息即可（notify）。</p> <hr> <p>https://juejin.im/user/5a6fdcfc51882522b5529eb0/posts</p> <p><a href="https://juejin.im/post/5d75afec6fb9a06aeb10e354" target="_blank" rel="noopener noreferrer">【Vue原理】Diff - 白话版<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/web-interview/interview-md/Vue - SSR.html" class="prev">
        SSR
      </a></span> <span class="next"><a href="/web-interview/interview-md/Webckpack.html">
        Webckpack
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/web-interview/assets/js/app.a79c4355.js" defer></script><script src="/web-interview/assets/js/2.6d940b43.js" defer></script><script src="/web-interview/assets/js/3.f8070b19.js" defer></script><script src="/web-interview/assets/js/35.6d76e154.js" defer></script>
  </body>
</html>
